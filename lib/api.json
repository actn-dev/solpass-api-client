{
  "openapi": "3.0.0",
  "paths": {
    "/": {
      "get": {
        "operationId": "AppController_getHello",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "App"
        ]
      }
    },
    "/partner": {
      "post": {
        "operationId": "PartnerController_create",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreatePartnerDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": ""
          }
        },
        "tags": [
          "Partner"
        ]
      },
      "get": {
        "operationId": "PartnerController_findAll",
        "parameters": [],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "Partner"
        ]
      }
    },
    "/partner/{id}": {
      "get": {
        "operationId": "PartnerController_findOne",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "Partner"
        ]
      },
      "patch": {
        "operationId": "PartnerController_update",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdatePartnerDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "Partner"
        ]
      },
      "delete": {
        "operationId": "PartnerController_remove",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": ""
          }
        },
        "tags": [
          "Partner"
        ]
      }
    },
    "/api/v1/events": {
      "post": {
        "operationId": "EventsController_createEvent",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateEventDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Event created successfully"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Create a new event (database only, blockchain init separate)",
        "tags": [
          "Events"
        ]
      },
      "get": {
        "operationId": "EventsController_findAll",
        "parameters": [
          {
            "name": "page",
            "required": false,
            "in": "query",
            "description": "Page number",
            "schema": {
              "example": 1,
              "type": "number"
            }
          },
          {
            "name": "limit",
            "required": false,
            "in": "query",
            "description": "Items per page",
            "schema": {
              "example": 10,
              "type": "number"
            }
          },
          {
            "name": "partnerId",
            "required": false,
            "in": "query",
            "description": "Filter by partner ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "blockchainEnabled",
            "required": false,
            "in": "query",
            "description": "Filter by blockchain enabled status",
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "upcoming",
            "required": false,
            "in": "query",
            "description": "Filter only upcoming events",
            "schema": {
              "example": true,
              "type": "boolean"
            }
          },
          {
            "name": "search",
            "required": false,
            "in": "query",
            "description": "Search in name and description",
            "schema": {
              "example": "Rock",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Events list retrieved"
          }
        },
        "summary": "Get all events with filtering and pagination",
        "tags": [
          "Events"
        ]
      }
    },
    "/api/v1/events/{id}": {
      "get": {
        "operationId": "EventsController_findOne",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Event UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Event details retrieved"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "summary": "Get event details by ID",
        "tags": [
          "Events"
        ]
      },
      "patch": {
        "operationId": "EventsController_update",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Event UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateEventDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Event updated successfully"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not event owner"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Update event details",
        "tags": [
          "Events"
        ]
      },
      "delete": {
        "operationId": "EventsController_remove",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Event UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Event deleted successfully"
          },
          "400": {
            "description": "Bad request - cannot delete blockchain-enabled events"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not event owner"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Delete event (soft delete)",
        "tags": [
          "Events"
        ]
      }
    },
    "/api/v1/events/{id}/initialize-blockchain": {
      "post": {
        "operationId": "EventsController_initializeBlockchain",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Event UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Blockchain initialized successfully"
          },
          "400": {
            "description": "Bad request or already initialized"
          },
          "401": {
            "description": "Unauthorized - Invalid API key"
          },
          "403": {
            "description": "Forbidden - not event owner"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Initialize event on blockchain (API Key auth)",
        "tags": [
          "Events"
        ]
      }
    },
    "/api/v1/events/{id}/stats": {
      "get": {
        "operationId": "EventsController_getStats",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Event UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Event stats retrieved"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not event owner"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get event statistics",
        "tags": [
          "Events"
        ]
      }
    },
    "/api/v1/events/{id}/distribute": {
      "post": {
        "description": "No request body needed. Partners and their wallet addresses are automatically extracted from the event database. All partners must have USDC token accounts enabled first.",
        "operationId": "EventsController_distributeRoyalty",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Event UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DistributeRoyaltyDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Royalties distributed successfully"
          },
          "400": {
            "description": "Bad request - already distributed, no royalties, or partners missing USDC accounts"
          },
          "401": {
            "description": "Unauthorized - Invalid API key"
          },
          "403": {
            "description": "Forbidden - not event owner"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Distribute royalties to party wallets (API Key auth)",
        "tags": [
          "Events"
        ]
      }
    },
    "/api/v1/events/{id}/escrow": {
      "get": {
        "operationId": "EventsController_getEscrowBalance",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Event UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Escrow balance retrieved"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not event owner"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get escrow balance for an event",
        "tags": [
          "Events"
        ]
      }
    },
    "/api/v1/events/{id}/enable-partner-usdc": {
      "post": {
        "operationId": "EventsController_enablePartnerUsdcAccounts",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Event UUID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "USDC accounts enabled for partners"
          },
          "400": {
            "description": "Bad request - partners missing wallet addresses"
          },
          "401": {
            "description": "Unauthorized"
          },
          "403": {
            "description": "Forbidden - not event owner"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Enable USDC token accounts for all partners (server wallet pays for creation)",
        "tags": [
          "Events"
        ]
      }
    },
    "/api/v1/events/{eventId}/tickets": {
      "post": {
        "operationId": "TicketsController_purchaseTicket",
        "parameters": [
          {
            "name": "eventId",
            "required": true,
            "in": "path",
            "schema": {
              "example": "concert-001",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateTicketDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Ticket purchased successfully"
          },
          "400": {
            "description": "Bad request"
          },
          "401": {
            "description": "Unauthorized - Invalid API key"
          },
          "404": {
            "description": "Event not found"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Purchase or resell a ticket (API Key auth required)",
        "tags": [
          "Tickets"
        ]
      },
      "get": {
        "operationId": "TicketsController_getEventTickets",
        "parameters": [
          {
            "name": "eventId",
            "required": true,
            "in": "path",
            "schema": {
              "example": "concert-001",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "All tickets for event retrieved from blockchain"
          }
        },
        "summary": "Get all tickets for an event",
        "tags": [
          "Tickets"
        ]
      }
    },
    "/api/v1/events/{eventId}/tickets/{ticketId}": {
      "get": {
        "operationId": "TicketsController_getTicket",
        "parameters": [
          {
            "name": "eventId",
            "required": true,
            "in": "path",
            "schema": {
              "example": "concert-001",
              "type": "string"
            }
          },
          {
            "name": "ticketId",
            "required": true,
            "in": "path",
            "schema": {
              "example": "ticket-001",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Ticket details retrieved"
          },
          "404": {
            "description": "Ticket not found"
          }
        },
        "summary": "Get ticket details",
        "tags": [
          "Tickets"
        ]
      }
    },
    "/api/v1/events/{eventId}/tickets/{ticketId}/history": {
      "get": {
        "operationId": "TicketsController_getTicketHistory",
        "parameters": [
          {
            "name": "eventId",
            "required": true,
            "in": "path",
            "schema": {
              "example": "concert-001",
              "type": "string"
            }
          },
          {
            "name": "ticketId",
            "required": true,
            "in": "path",
            "schema": {
              "example": "ticket-001",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Ticket transaction history retrieved"
          },
          "404": {
            "description": "No history found"
          }
        },
        "summary": "Get ticket transaction history",
        "tags": [
          "Tickets"
        ]
      }
    },
    "/api/v1/auth/register": {
      "post": {
        "operationId": "AuthController_register",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered successfully"
          },
          "409": {
            "description": "Email or wallet already exists"
          }
        },
        "summary": "Register a new user/partner",
        "tags": [
          "Auth"
        ]
      }
    },
    "/api/v1/auth/login": {
      "post": {
        "operationId": "AuthController_login",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful, returns JWT token"
          },
          "401": {
            "description": "Invalid credentials"
          }
        },
        "summary": "Login with email and password",
        "tags": [
          "Auth"
        ]
      }
    },
    "/api/v1/auth/me": {
      "get": {
        "operationId": "AuthController_getProfile",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Returns current user information"
          },
          "401": {
            "description": "Unauthorized - Invalid or expired token"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get current user profile (verify JWT token)",
        "tags": [
          "Auth"
        ]
      }
    },
    "/api/v1/auth/api-key": {
      "get": {
        "operationId": "AuthController_getApiKey",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Returns API key",
            "content": {
              "application/json": {
                "schema": {
                  "example": {
                    "apiKey": "sk_abc123..."
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or expired token"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Get API key for programmatic access (JWT required)",
        "tags": [
          "Auth"
        ]
      }
    },
    "/api/v1/auth/regenerate-key": {
      "post": {
        "operationId": "AuthController_regenerateApiKey",
        "parameters": [],
        "responses": {
          "200": {
            "description": "New API key generated",
            "content": {
              "application/json": {
                "schema": {
                  "example": {
                    "apiKey": "sk_xyz789..."
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or expired token"
          }
        },
        "security": [
          {
            "bearer": []
          }
        ],
        "summary": "Regenerate API key (invalidates old key, JWT required)",
        "tags": [
          "Auth"
        ]
      }
    }
  },
  "info": {
    "title": "Solpass Ticket API",
    "description": "RESTful API for Solana-based ticket management",
    "version": "1.0",
    "contact": {}
  },
  "tags": [
    {
      "name": "Events",
      "description": ""
    },
    {
      "name": "Tickets",
      "description": ""
    },
    {
      "name": "Auth",
      "description": ""
    },
    {
      "name": "Ticket Operations",
      "description": ""
    },
    {
      "name": "Development & Testing",
      "description": ""
    }
  ],
  "servers": [],
  "components": {
    "securitySchemes": {
      "bearer": {
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "type": "http",
        "name": "JWT",
        "description": "Enter JWT token",
        "in": "header"
      }
    },
    "schemas": {
      "CreatePartnerDto": {
        "type": "object",
        "properties": {}
      },
      "UpdatePartnerDto": {
        "type": "object",
        "properties": {}
      },
      "RoyaltyPartnerDto": {
        "type": "object",
        "properties": {
          "partyName": {
            "type": "string",
            "example": "Artist",
            "description": "Party name"
          },
          "percentage": {
            "type": "number",
            "example": 5,
            "description": "Percentage (0-100)"
          },
          "walletAddress": {
            "type": "string",
            "example": "So1ana...wallet",
            "description": "Solana wallet address"
          }
        },
        "required": [
          "partyName",
          "percentage"
        ]
      },
      "CreateEventDto": {
        "type": "object",
        "properties": {
          "eventId": {
            "type": "string",
            "example": "concert-001",
            "description": "Unique event identifier (max 16 chars)"
          },
          "name": {
            "type": "string",
            "example": "Rock Show",
            "description": "Event name (max 32 chars)"
          },
          "description": {
            "type": "string",
            "example": "Amazing rock concert",
            "description": "Event description"
          },
          "venue": {
            "type": "string",
            "example": "Madison Square Garden",
            "description": "Event venue"
          },
          "eventDate": {
            "type": "string",
            "example": "2025-12-31T20:00:00Z",
            "description": "Event date in ISO format"
          },
          "totalTickets": {
            "type": "number",
            "example": 1000,
            "description": "Total number of tickets available"
          },
          "ticketPrice": {
            "type": "number",
            "example": 100,
            "description": "Ticket price in smallest currency unit"
          },
          "royaltyDistribution": {
            "example": [
              {
                "partyName": "Artist",
                "percentage": 5
              },
              {
                "partyName": "Venue",
                "percentage": 3
              }
            ],
            "description": "Royalty distribution among parties",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RoyaltyPartnerDto"
            }
          }
        },
        "required": [
          "eventId",
          "name",
          "description",
          "venue",
          "eventDate",
          "totalTickets",
          "ticketPrice",
          "royaltyDistribution"
        ]
      },
      "UpdatePartnerWalletDto": {
        "type": "object",
        "properties": {
          "partyName": {
            "type": "string",
            "example": "Artist",
            "description": "Party name (must match existing partner)"
          },
          "walletAddress": {
            "type": "string",
            "example": "So1ana...wallet",
            "description": "Solana wallet address to set for this partner"
          }
        },
        "required": [
          "partyName",
          "walletAddress"
        ]
      },
      "UpdateEventDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "example": "Rock Show",
            "description": "Event name (max 32 chars)"
          },
          "description": {
            "type": "string",
            "example": "Amazing rock concert",
            "description": "Event description"
          },
          "venue": {
            "type": "string",
            "example": "Madison Square Garden",
            "description": "Event venue"
          },
          "eventDate": {
            "type": "string",
            "example": "2025-12-31T20:00:00Z",
            "description": "Event date in ISO format"
          },
          "royaltyDistribution": {
            "description": "Update partner wallet addresses only. Pass array of {partyName, walletAddress}. Cannot change percentages or add/remove partners after blockchain initialization.",
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UpdatePartnerWalletDto"
            }
          }
        }
      },
      "DistributeRoyaltyDto": {
        "type": "object",
        "properties": {}
      },
      "CreateTicketDto": {
        "type": "object",
        "properties": {
          "ticketId": {
            "type": "string",
            "example": "ticket-001",
            "description": "Unique ticket identifier"
          },
          "buyerWallet": {
            "type": "string",
            "example": "7xKzU8fPPwV3wkF9YqGVXJb4qQZ3GqYvJ9Z3sV7wV7wV",
            "description": "Buyer wallet public key (base58)"
          },
          "sellerWallet": {
            "type": "string",
            "example": "8yKzU8fPPwV3wkF9YqGVXJb4qQZ3GqYvJ9Z3sV7wV7wX",
            "description": "Seller wallet public key (base58)"
          },
          "newPrice": {
            "type": "number",
            "example": 120,
            "description": "New resale price in USD"
          },
          "originalPrice": {
            "type": "number",
            "example": 100,
            "description": "Original ticket purchase price in USD"
          },
          "buyerId": {
            "type": "string",
            "example": "buyer-123",
            "description": "Buyer ID for ticket ownership"
          },
          "sellerId": {
            "type": "string",
            "example": "seller-456",
            "description": "Seller ID for ticket ownership"
          }
        },
        "required": [
          "ticketId",
          "buyerWallet",
          "sellerWallet",
          "newPrice",
          "originalPrice",
          "buyerId",
          "sellerId"
        ]
      },
      "RegisterDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "partner@example.com"
          },
          "password": {
            "type": "string",
            "example": "StrongPass123!"
          },
          "walletAddress": {
            "type": "string",
            "example": "7xKzU8fPPwV3wkF9YqGVXJb4qQZ3GqYvJ9Z3sV7wV7wV"
          }
        },
        "required": [
          "email",
          "password",
          "walletAddress"
        ]
      },
      "LoginDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "partner@example.com"
          },
          "password": {
            "type": "string",
            "example": "StrongPass123!"
          }
        },
        "required": [
          "email",
          "password"
        ]
      }
    }
  }
}